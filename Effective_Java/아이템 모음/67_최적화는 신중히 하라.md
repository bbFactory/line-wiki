# 9장. 일반적인 프로그래밍 원칙(p343~384)

> 이번 장에서는 자바 언어의 핵심 요소라고 할 수 있는 다음 내용들을 다룬다.
>
> - 지역변수
> - 제어구조
> - 라이브러리
> - 데이터 타입 
> - 리플렉션과(언어 경계를 넘나드는 기능) 
> - 네이티브 메서드
> - 최적화와 명명 규칙

## 아이템 67. 최적화는 신중히 하라(p377~380)

성능 때문에 견고한 구조를 희생하지 말자. **빠른 프로그램보다는 좋은 프로그램을 작성하자.** 다음의 격언을 참고하면 좋을 것이다.

> (맹목적인 어리석음을 포함해) 그 어떤 핑계보다 효율성이라는 이름 아래 행해진 컴퓨팅 죄악이 더 많다(심지어 효율을 높이지도 못하면서).
>
> – 윌리엄 울프(Wulf72]

>  (전체의 97% 정도인) 자그마한 효율성은 모두 잊자. 섣부른 최적화가 만악의 근원이다.
>
> – 도널드 크누스[Knuth74]

> 최적화를 할 때는 다음 두 규칙을 따르라.
> 첫 번째, 하지 마라.
> 두 번째, (전문가 한정) 아직 하지 마라. 다시 말해, 완전히 명백하고 최적화되지 않은 해법을 찾을 때까지는 하지 마라.
>
> – M. A. THE[Jackson 75]

시스템의 나머지에 영향을 주지 않고 독립적인 아키텍처의 각 요소를 다시 설계하여 성능을 높일 수도 있다. 하지만 이미 완성된 설계의 틀을 변경하는 것이 쉽지 않으니 설계 단계에서 반드시 성능을 고려하자.

**성능을 제한하는 설계를 피하라.** API, 네트워크 프로토콜, 영구 저장용 데이터 포맷 등은 한 번 완성되면 변경하기 어렵다는 점을 기억하자.

**API를 설계할 때 성능에 주는 영향을 고려하라.** 

- public 컴포넌트에서 내부 데이터를 변경할 수 있게 만들면 불필요한 방어적 복사를 수없이 유발할 수 있다(아이템 50).
- 컴포지션을 사용할 수 있음에도 상속 방식으로 설계한 public 클래스는 상위 클래스에 그 성능의 제약까지 영원히 종속된다(아이템 18).
- 인터페이스가 있는데 굳이 구현 타입을 사용하는 것도 좋지 않다. 이 경우, 나중에 더 빠른 구현체가 나오더라도 이를 이용하지 못하게 된다(아이템 64).

최적화를 시도하려면, **“최적화 시도 전후로 각각의 성능을 측정하라"**. 최적화 시도가 항상 더 나은 결과를 이끄는 것은 아니다. 

프로파일링 도구(profiling tool)를 사용하여 도움을 얻을 수도 있다. 프로파일링 도구는 개별 메서드의 소비 시간과 호출 횟수 같은 런타임 정보를 제공한다. 눈에 띄게 프로그램 시간이 증가하는 부분을 찾아 알고리즘을 개선하는 것도 최적화를 하는 하나의 방법이다.

## 마무리

- 빠른 프로그램을 작성하려 하지 말고 좋은 프로그램을 작성하자. 특히 API, 네트워크 프로토콜, 영구 저장용 데이터 포맷을 설계할 때는 성능을 염두에 두어야 한다.
- 성능이 떨어진다면, 프로파일러를 사용해 문제의 원인이 되는 지점을 찾아 최적화를 수행하자. 가장 먼저 어떤 알고리즘을 사용했는지를 살펴보고 수정하자. 만족할 때까지 이 과정을 반복하고, 모든 변경 후에는 성능을 측정하자.


