# 9장. 일반적인 프로그래밍 원칙(p343~384)

> 이번 장에서는 자바 언어의 핵심 요소라고 할 수 있는 다음 내용들을 다룬다.
>
> - 지역변수
> - 제어구조
> - 라이브러리
> - 데이터 타입 
> - 리플렉션과(언어 경계를 넘나드는 기능) 
> - 네이티브 메서드
> - 최적화와 명명 규칙

## 아이템 66. 네이티브 메서드는 신중히 사용하라(p375~376)

## 자바 네이티브 인터페이스

> 자바 네이티브 인터페이스(Java Native Intertice, JNI)는 자바 프로그램이 네이티브 메서드를 호출하는 기술이다. 여기서 네이티브 메서드란 C나 C++ 같은 네이티브 프로그래밍 언어로 작성한 메서드를 말한다.

## 네이티브 메서드의 쓰임

- **쓰임 1**: 레지스트리 같은 플랫폼 특화 기능을 사용한다.
- **쓰임 2**: 네이티브 코드로 작성된 기존 라이브러리를 사용한다(레거시 데이터를 사용하는 레거시 라이브러리 등).
- **쓰임 3**: 성능 개선을 목적으로 성능에 결정적인 영향을 주는 영역만 따로 네이티브 언어로 작성한다.
- **쓰임 4**: 대체할 만한 자바 라이브러리가 없는 네이티브 라이브러리를 사용해야 할 때 사용한다.

**성능을 개선할 목적으로 네이티브 메서드를 사용하는 것은 거의 권장하지 않는다.** 지금까지 발전을 거듭해온 자바가 다른 플랫폼에 견줄만한 성능을 보이기 때문이다. 예를 들어 자바 1.1 시절의 BigInteger는 C로 작성한 라이브러리에 의지했지만, 자바 3 때 순수 자바로 구현되며 기존의 네이티브 구현보다 더 빨라졌다.

> 한편, 네이티브 라이브러리 쪽은 GNU 다중 정밀 연산 라이브러리(GMP)를 필두로 개선 작업이 계속돼왔다. 그래서 정말로 고성능의 다중 정밀 연산이 필요한 경우라면 네이티브 메서드를 통해 GMP를 사용해도 좋다.

## 네이티브 메서드의 단점

네이티브 메서드는 사용시 몇 가지 단점을 보인다.

- **단점 1**:  **네이티브 언어가 안전하지 않다**(아이템 50). 이 때문에 네이티브 메서드를 사용하는 애플리케이션도 메모리 훼손 오류로부터 안전하지 않게 된다. 
- **단점 2**: **네이티브 언어가 자바보다 플랫폼을 많이 타서 이식성이 낮다.**
- **단점 3**: **디버깅이 보다 어렵다.** 
- **단점 4**: **속도가 오히려 느려질 수도 있다.** 가비지 컬렉터는 네이티브 메모리를 자동 회수하지 못하고, 심지어 추적조차 할 수 없다(아이템 8), 자바 코드와 네이티브 코드의 경계를 넘나드는 비용도 추가된다.
- **단점 5**: **네이티브 메서드와 자바 코드 사이의 '접착 코드(glue code)'를 작성해야 한다.** 이는 귀찮고 가독성이 떨어지는 작업이다.

## 마무리

- 성능 개선을 위해 네이티브 메서드를 고려하고 있다면 한번 더 생각하자. 자바가 보여주는 성능이 이미 충분히 좋아졌다.
- 어쩔 수 없이 (저수준 자원이나 네이티브 라이브러리를 사용해야 해서) 네이티브 코드를 사용하더라도 최소한만 사용하고 철저히 테스트하자.


