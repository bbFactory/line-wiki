# Chapter 04. 스프링 시큐리티

소프트웨어 개발자로써 우리느 애플리케이션에 있는 정보를 보호하는 조치를 해야 한다. 앞으로 **스프링 시큐리티를 자동 구성** 하는 방법, **커스텀 사용자 스토리지** 를 정의하는 방법 등을 배우고, **커스텀 로그인 페이지** 를 만들어볼 것이다. 또한 **CSRF 공격** 을 막아보고, **사용자를 파악** 해보는 방법을 살펴볼 것이다.

## 4.1 스프링 시큐리티 활성화하기(p117~120)

스프링 애플리케이션의 보안에서 가장 먼저 할 일은 **스프링 부트 보안 스타터 의존성** 을 빌드 명세에 추가하는 것이다. 아래 pom.xml 파일에서 추가하는 첫 번째 `<dependency>` 항목은 스프링 부트 보안 스타터 의존성이고, 두 번째는 보안 테스트 의존성이다.

```xml
...
<dependencies>
	...
    <dependency>
    	<groupdId>org.springframework.boot</groupdId>
        <artifactId>spring-boot-starter-security</artifactId>
    </dependency>
    
    <dependency>
    	<gorupId>org.springframework.security</gorupId>
        <artifactId>spring-security-test</artifactId>
        <scope>test</scope>
    </dependency>
</dependencies>
```

놀랍게도 방금 추가한 의존성이 스프링 애플리케이션을 안전하게 하기 위해 필요한 전부이다. 애플리케이션이 시작되면 스프링이 우리 프로젝트의 classpath에 있는 스프링 시큐리티 라이브러리를 찾아 기본적인 보안 구성을 설정한다.

어떻게 설정해 주는지 확인하려면 애플리케이션을 시작한 후, 웹 브라우저에서 홈페이지(http://localhost:8080)이나 타코 디자인 페이지(http://localhost:8080/design)에 접속해 보자. 그러면 스프링 시큐리티에서 제공하는 HTTP 기본 인증 대화상자가 나타난다.

기본 인증 대화상자에서 Username 필드에 "user"라고 입력한다. Password는 무작위로 자동 생성되어 애플리케이션 로그 파일에 수록된다. STS를 사용하는 경우 콘솔 창에 다음과 같은 로그 항목이 나타난다.

```
Using generated security password: 6838886b-edb5-40d8-bc45-395ba25a79e4
```

뒤쪽 36자리의 비밀번호를 마우스로 선택하여 복사한 후 Password 필드에 붙여넣기 하고 Sign in 버튼을 클릭하면 로그인된다. 그러면 애플리케이션을 사용할 수 있는 권한이 부여되어 우리가 접속한 페이지가 나타난다. 스프링의 username(사용자 이름)은 사용자 id를 의미한다.

지금부터는 스프링 시큐리티의 보안 자동 구성이 어떻게 제공되는지 알아보자.

먼저 보안 스타터를 프로젝트 빌드 파일에 추가만 할 경우 다음의 보안 구성이 제공된다.

- 모든 HTTP 요청 경로는 인증(authentication) 되어야 한다.
- 어떤 특정 역할이나 권한이 없다.
- 로그인 페이지가 따로 없다.
- 스프링 시큐리티의 HTTP 기본 인증(앞서 했던 인증)을 사용해서 인증된다.
- 사용자는 user 이름으로 하나만 존재한다. 비밀번호는 암호화해준다.

타코 클라우드 애플리케이션을 비롯하여 자신만의 애플리케이션을 만들 땐 보안을 제대로 구축하기 위해 더 많은 작업이 필요하며, 최소한 다음 기능을 할 수 있도록 스프링 시큐리티를 구성해야 한다.

-  스프링 시큐리티의 HTTP 인증 대화상자 대신 우리의 로그인 페이지로 인증한다.
- 다수의 사용자를 제공하며, 새로운 타코 클라우드 고객이 사용자로 등록할 수 있는 페이지가 있어야 한다.
- 서로 다른 HTTP 요청 경로마다 서로 다른 보안 규칙을 적용한다. 예를 들어 홈페이지와 사용자 등록 페이지는 인증이 필요하지 않다.

위와 같은 보안 요구를 충족하기 위해서 스프링 자동-구성이 하는 것을 대체하는 작업을 해야 한다. 우선 한 명 이상의 사용자를 가질 수 있도록 타코 클라우드에 적합한 사용자 스토어(store)를 구성해보자.
